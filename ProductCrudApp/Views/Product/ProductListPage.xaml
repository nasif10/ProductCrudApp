<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ProductCrudApp.Views.Product.ProductListPage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             Title="Product List">
    
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Add" Order="Secondary" Command="{Binding AddCommand}" />
    </ContentPage.ToolbarItems>

    <StackLayout BackgroundColor="#f7f9fe">
        <toolkit:Expander>
            <toolkit:Expander.Header>
                <Border Padding="20,10" Margin="5,0,7,0" BackgroundColor="White" StrokeShape="RoundRectangle 5">
                    <StackLayout Orientation="Horizontal" HorizontalOptions="Center">
                        <Label Text="Search" TextColor="Black" FontAttributes="Bold" FontSize="14"/>
                    </StackLayout>
                </Border>
            </toolkit:Expander.Header>
            <Grid>
                <SearchBar Placeholder="Search items..." Text="{Binding SearchText}" />
            </Grid>
        </toolkit:Expander>

        <ActivityIndicator IsVisible="{Binding IsBusy}" IsRunning="{Binding IsBusy}"/>

        <RefreshView RefreshColor="#2196F3" IsRefreshing="{Binding IsRefreshing}" Command="{Binding RefreshCommand}">
            <ScrollView>
                <StackLayout>
                    <CollectionView ItemsSource="{Binding Products}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <StackLayout Padding="5,5,7,0">
                                    <Border Padding="10,7" Margin="0,2,0,0" BackgroundColor="White">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="9*" />
                                                <ColumnDefinition Width="1*" />
                                            </Grid.ColumnDefinitions>
                                            <StackLayout Grid.Column="0" Margin="0,5,0,5">
                                                <StackLayout Orientation="Horizontal">
                                                    <Label Text="Name: " TextColor="black" FontSize="12"/>
                                                    <Label Text="{Binding Name}" TextColor="black" FontSize="13" FontAttributes="Bold"/>
                                                </StackLayout>
                                                <StackLayout Orientation="Horizontal">
                                                    <Label Text="Category: " TextColor="black" FontSize="12"/>
                                                    <Label Text="{Binding CategoryName}" TextColor="black" FontSize="13" FontAttributes="Bold"/>
                                                </StackLayout>
                                                <StackLayout Orientation="Horizontal">
                                                    <Label Text="Image: " TextColor="black" FontSize="12"/>
                                                    <Label Text="{Binding Image}" TextColor="Blue" FontSize="13">
                                                        <Label.GestureRecognizers>
                                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ShowImageCommand}" 
                                                                                  CommandParameter="{Binding Image}"/>
                                                        </Label.GestureRecognizers>
                                                    </Label>
                                                </StackLayout>
                                                <StackLayout Orientation="Horizontal">
                                                    <Label Text="Description: " TextColor="black" FontSize="12"/>
                                                    <Label Text="{Binding Description}" FontSize="13" TextColor="black" FontAttributes="Bold" />
                                                </StackLayout>
                                                <StackLayout Orientation="Horizontal">
                                                    <Label Text="Price: " TextColor="black" FontSize="12"/>
                                                    <Label Text="{Binding Price}" TextColor="black" FontSize="13" FontAttributes="Bold"/>
                                                </StackLayout>
                                            </StackLayout>
                                            <Grid Grid.Column="1">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="*" />
                                                    <RowDefinition Height="*" />
                                                </Grid.RowDefinitions>

                                                <Label Grid.Row="0" Text="&#xe3c9;" FontFamily="MaterialIconsOutlined" FontSize="22" TextColor="Orange" VerticalOptions="Center">
                                                    <Label.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding Path=BindingContext.EditCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                                                              CommandParameter="{Binding Id}" />
                                                    </Label.GestureRecognizers>
                                                </Label>
                                                <Label Grid.Row="1" Text="&#xe872;" FontFamily="MaterialIconsOutlined" FontSize="23" TextColor="OrangeRed" VerticalOptions="Center">
                                                    <Label.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding Path=BindingContext.DeleteCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                                                              CommandParameter="{Binding Id}" />
                                                    </Label.GestureRecognizers>
                                                </Label>
                                            </Grid>
                                        </Grid>
                                    </Border>
                                </StackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </ScrollView>
        </RefreshView>
    </StackLayout>
</ContentPage>